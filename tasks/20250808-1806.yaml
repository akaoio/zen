agent: swarm-2-zen-architect
task: Design memory ownership model for AST nodes to prevent double-free
created: 1754651190
completed: false
files:
  - src/core/ast.c
  - ARCHITECTURE.md
activities:
  - timestamp: 1754651190
    start: 1754651190
    end: 0
    method: Task initialized
    success: false
    fail: false
    why_success: In progress
    why_fail: Not completed yet
  - timestamp: 1754651198
    start: 1754651198
    end: 0
    method: 'URGENT: AST double-free crashes affect all operations. Root cause: AST nodes shared between multiple places in tree (e.g., function parameters), causing same node to be freed multiple times. Need clear memory ownership model - either reference counting, ownership transfer, or deep copying. Stack trace shows ast_free recursively freeing same nodes.'
    success: false
    fail: false
    why_success: In progress
    why_fail: Not completed yet
  - timestamp: 1754651228
    start: 1754651228
    end: 0
    method: 'URGENT UPDATE: The root cause is the unauthorized ast_copy() function at line 841 in ast.c. This function is NOT in MANIFEST.json but is being used extensively, creating shared AST node references that cause double-free crashes during cleanup. This function must be REMOVED or ADDED to manifest officially. Every ast_copy() call violates the manifest contract.'
    success: false
    fail: false
    why_success: In progress
    why_fail: Not completed yet
